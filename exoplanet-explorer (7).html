<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Nick's Astro Lab ‚Äî Exoplanet Habitability Explorer</title>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:#07070d;--surface:#0e0e18;--surface2:#161624;--border:#1e1e34;
  --text:#e0dff0;--text-dim:#8887a0;--text-faint:#55546a;
  --pink:#f472b6;--pink-glow:#f472b640;--pink-deep:#be185d;
  --green:#34d399;--red:#f87171;--radius:12px;
}
html{font-size:16px}
body{font-family:'Outfit',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden}
body::before{
  content:'';position:fixed;inset:0;pointer-events:none;z-index:0;
  background-image:
    radial-gradient(1px 1px at 10% 20%,#ffffff22,transparent),
    radial-gradient(1px 1px at 30% 70%,#ffffff16,transparent),
    radial-gradient(1.5px 1.5px at 50% 10%,#ffffff1a,transparent),
    radial-gradient(1px 1px at 70% 40%,#ffffff14,transparent),
    radial-gradient(1px 1px at 90% 80%,#ffffff18,transparent),
    radial-gradient(1px 1px at 60% 55%,#ffffff12,transparent),
    radial-gradient(1px 1px at 85% 15%,#ffffff20,transparent),
    radial-gradient(1px 1px at 40% 35%,#ffffff0e,transparent);
}
.app{position:relative;z-index:1;max-width:940px;margin:0 auto;padding:40px 24px 20px}
.header{text-align:center;margin-bottom:44px;position:sticky;top:0;z-index:30;background:var(--bg);padding:20px 0 16px;border-bottom:1px solid var(--border);margin-left:-24px;margin-right:-24px;padding-left:24px;padding-right:24px}
.header-label{display:inline-block;font-size:.68rem;font-weight:600;letter-spacing:3.5px;text-transform:uppercase;color:#00d4ff;border:1px solid #00d4ff50;padding:6px 18px;border-radius:100px;margin-bottom:20px}
h1{font-size:2.5rem;font-weight:700;letter-spacing:-.5px;line-height:1.15;background:linear-gradient(135deg,#fff 0%,var(--pink) 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin-bottom:14px}
.subtitle{color:var(--text-dim);font-size:1rem;line-height:1.6;max-width:600px;margin:0 auto;font-weight:300}
/* Panels */
.panel{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:28px 32px;margin-bottom:24px;box-shadow:0 4px 40px #00000050,inset 0 1px 0 #ffffff05}
.panel-title{font-size:.7rem;font-weight:600;letter-spacing:2.5px;text-transform:uppercase;color:var(--text-dim);margin-bottom:20px;display:flex;align-items:center;gap:10px}
.panel-title::after{content:'';flex:1;height:1px;background:var(--border)}
/* Inputs */
.system-row{margin-bottom:16px}
.system-row label{display:block;font-size:.76rem;font-weight:500;color:var(--text-dim);margin-bottom:6px}
.system-select{width:100%;padding:11px 14px;background:var(--bg);border:1px solid var(--border);border-radius:8px;color:var(--text);font-family:'Outfit',sans-serif;font-size:.88rem;cursor:pointer;outline:none;transition:border-color .2s,box-shadow .2s;appearance:none;-webkit-appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' fill='none'%3E%3Cpath d='M1 1.5l5 5 5-5' stroke='%238887a0' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 14px center}
.system-select:focus{border-color:var(--pink);box-shadow:0 0 0 3px var(--pink-glow)}
.system-select option{background:var(--surface);color:var(--text)}
.divider{display:flex;align-items:center;gap:12px;margin:14px 0;color:var(--text-faint);font-size:.72rem;letter-spacing:1px}
.divider::before,.divider::after{content:'';flex:1;height:1px;background:var(--border)}
.input-grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:14px}
@media(max-width:640px){.input-grid{grid-template-columns:1fr}}
.field label{display:block;font-size:.76rem;font-weight:500;color:var(--text-dim);margin-bottom:6px}
.field label span{color:var(--text-faint);font-weight:400}
.field input{width:100%;padding:11px 14px;background:var(--bg);border:1px solid var(--border);border-radius:8px;color:var(--text);font-family:'JetBrains Mono',monospace;font-size:.88rem;transition:border-color .2s,box-shadow .2s;outline:none}
.field input:focus{border-color:var(--pink);box-shadow:0 0 0 3px var(--pink-glow)}
.btn-row{margin-top:20px;display:flex;gap:10px;flex-wrap:wrap}
.btn{padding:11px 24px;border-radius:8px;font-family:'Outfit',sans-serif;font-size:.86rem;font-weight:600;cursor:pointer;border:none;transition:all .2s;letter-spacing:.3px}
.btn-primary{background:linear-gradient(135deg,var(--pink),var(--pink-deep));color:#fff;box-shadow:0 2px 16px var(--pink-glow)}
.btn-primary:hover{transform:translateY(-1px);box-shadow:0 4px 24px var(--pink-glow)}
.btn-secondary{background:var(--surface2);color:var(--text-dim);border:1px solid var(--border)}
.btn-secondary:hover{color:var(--text);border-color:var(--text-faint)}
.btn-random{background:linear-gradient(135deg,#6366f1,#4f46e5);color:#fff;box-shadow:0 2px 12px #6366f140}
.btn-random:hover{transform:translateY(-1px);box-shadow:0 4px 20px #6366f160}
/* Slider */
.slider-row{margin-top:16px}
#tempSlider{width:100%;-webkit-appearance:none;appearance:none;height:6px;border-radius:3px;outline:none;cursor:pointer;background:linear-gradient(90deg,#ffac6b,#ffd2a1,#fff4ea,#f8f7ff,#cad7ff,#aabfff,#9bb0ff)}
#tempSlider::-webkit-slider-thumb{-webkit-appearance:none;width:20px;height:20px;border-radius:50%;background:#fff;border:2px solid var(--pink);cursor:pointer;box-shadow:0 0 10px var(--pink-glow),0 2px 6px #00000040}
#tempSlider::-moz-range-thumb{width:20px;height:20px;border-radius:50%;background:#fff;border:2px solid var(--pink);cursor:pointer;box-shadow:0 0 10px var(--pink-glow)}
/* Results */
.results{opacity:0;transform:translateY(12px);transition:opacity .5s ease,transform .5s ease;pointer-events:none;max-height:0;overflow:hidden}
.results.visible{opacity:1;transform:translateY(0);pointer-events:auto;max-height:none;overflow:visible}
/* Stat cards */
.stat-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:14px;margin-bottom:24px}
@media(max-width:640px){.stat-grid{grid-template-columns:1fr}}
.stat-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:18px;text-align:center;box-shadow:inset 0 1px 0 #ffffff05;transition:transform .3s,box-shadow .3s}
.stat-card:hover{transform:translateY(-2px);box-shadow:0 4px 20px #00000040}
.stat-label{font-size:.68rem;font-weight:500;color:var(--text-dim);letter-spacing:1.5px;text-transform:uppercase;margin-bottom:6px}
.stat-value{font-family:'JetBrains Mono',monospace;font-size:1.3rem;font-weight:500}
.stat-unit{font-size:.72rem;color:var(--text-dim);margin-top:3px}
.spectral-badge{display:inline-block;padding:4px 14px;border-radius:6px;font-family:'JetBrains Mono',monospace;font-size:1.3rem;font-weight:700}
/* Orbital */
.orbital-wrap{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:0;margin-bottom:24px;overflow:hidden;position:relative;box-shadow:0 8px 60px #00000060,inset 0 1px 0 #ffffff05}
.orbital-header{padding:24px 28px 0;display:flex;justify-content:space-between;align-items:center}
.orbital-title{font-size:.7rem;font-weight:600;letter-spacing:2.5px;text-transform:uppercase;color:var(--text-dim)}
.orbital-controls{display:flex;gap:8px}
.orbital-btn{padding:5px 12px;border-radius:6px;font-size:.7rem;font-weight:500;cursor:pointer;border:1px solid var(--border);background:var(--surface2);color:var(--text-dim);font-family:'Outfit',sans-serif;transition:all .2s}
.orbital-btn:hover{border-color:var(--pink);color:var(--pink)}
.orbital-btn.active{border-color:var(--pink);color:var(--pink);background:#f472b610}
.orbital-canvas-wrap{position:relative;width:100%;aspect-ratio:16/10;min-height:380px}
.orbital-canvas-wrap canvas{width:100%;height:100%;display:block}
.orbital-legend{padding:14px 28px 18px;display:flex;gap:18px;flex-wrap:wrap;justify-content:center;border-top:1px solid var(--border)}
.oleg{display:flex;align-items:center;gap:5px;font-size:.7rem;color:var(--text-dim)}
.oleg-dot{width:9px;height:9px;border-radius:50%}
.oleg-ring{width:11px;height:11px;border-radius:50%;border:2px solid;background:transparent}
/* HZ bar */
.hz-bar{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:20px 28px;margin-bottom:24px;display:grid;grid-template-columns:repeat(3,1fr);gap:14px;box-shadow:inset 0 1px 0 #ffffff05}
@media(max-width:640px){.hz-bar{grid-template-columns:1fr}}
.hz-item{text-align:center}.hz-item-label{font-size:.68rem;color:var(--text-dim);letter-spacing:1px;text-transform:uppercase;margin-bottom:3px}.hz-item-value{font-family:'JetBrains Mono',monospace;font-size:1.05rem;font-weight:500}
/* Planet table */
.planet-table-wrap{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:28px 32px;box-shadow:0 4px 30px #00000040,inset 0 1px 0 #ffffff05;overflow-x:auto;display:none;margin-bottom:24px}
.planet-table-wrap.visible{display:block}
.planet-table{width:100%;border-collapse:collapse}
.planet-table th{font-size:.68rem;font-weight:600;letter-spacing:1.5px;text-transform:uppercase;color:var(--text-dim);text-align:left;padding:8px 12px;border-bottom:1px solid var(--border)}
.planet-table td{padding:10px 12px;border-bottom:1px solid var(--border);font-family:'JetBrains Mono',monospace;font-size:.8rem}
.planet-table tr:last-child td{border-bottom:none}
.planet-table tr{transition:background .15s}
.planet-table tr:hover{background:var(--surface2)}
.planet-table tr.hz-row{background:#34d39908}
.planet-name-cell{font-family:'Outfit',sans-serif;font-weight:500;font-size:.88rem;color:var(--text);display:flex;align-items:center;gap:8px}
.planet-pip{width:8px;height:8px;border-radius:50%;flex-shrink:0}
.hz-yes{color:var(--green);font-weight:600}.hz-no{color:var(--red);font-weight:500;opacity:.65}
.hz-status-pip{display:inline-block;width:7px;height:7px;border-radius:50%;margin-right:7px;vertical-align:middle}
.unknown{color:var(--text-faint);font-style:italic;font-family:'Outfit',sans-serif}
.badge{display:inline-block;font-size:.7rem;font-weight:600;padding:2px 10px;border-radius:100px;margin-left:10px;letter-spacing:.5px;font-family:'JetBrains Mono',monospace}
.badge-pink{background:#f472b614;color:var(--pink)}.badge-green{background:#34d39914;color:var(--green)}
/* Canvas panels (HR, bar, scatter) */
.chart-panel{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:0;margin-bottom:24px;overflow:hidden;box-shadow:0 4px 40px #00000050,inset 0 1px 0 #ffffff05}
.chart-header{padding:22px 28px 0;display:flex;justify-content:space-between;align-items:center}
.chart-title{font-size:.7rem;font-weight:600;letter-spacing:2.5px;text-transform:uppercase;color:var(--text-dim)}
.chart-sub{font-size:.7rem;color:var(--text-faint)}
.chart-canvas-wrap{position:relative;width:100%}
.chart-canvas-wrap canvas{width:100%;height:100%;display:block}
.chart-legend{padding:12px 28px 16px;display:flex;gap:16px;flex-wrap:wrap;justify-content:center;border-top:1px solid var(--border);font-size:.7rem;color:var(--text-dim)}
.cleg{display:flex;align-items:center;gap:5px}
.cleg-dot{width:9px;height:9px;border-radius:50%}
/* Charts grid */
.charts-row{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:24px}
@media(max-width:700px){.charts-row{grid-template-columns:1fr}}
/* Summary stat */
.summary-stat{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:24px 32px;margin-bottom:24px;text-align:center;box-shadow:inset 0 1px 0 #ffffff05}
.summary-big{font-family:'JetBrains Mono',monospace;font-size:2.8rem;font-weight:700;background:linear-gradient(135deg,var(--green),#67e8f9);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.summary-label{font-size:.82rem;color:var(--text-dim);margin-top:6px;line-height:1.5}
/* Compare */
.compare-toggle{display:flex;justify-content:center;margin-bottom:24px;gap:4px;background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:4px;width:fit-content;margin-left:auto;margin-right:auto}
.compare-toggle button{padding:8px 22px;border-radius:8px;font-family:'Outfit',sans-serif;font-size:.82rem;font-weight:600;cursor:pointer;border:none;color:var(--text-dim);background:transparent;transition:all .2s}
.compare-toggle button.active{background:var(--pink-deep);color:#fff;box-shadow:0 2px 12px var(--pink-glow)}
.compare-wrap{display:none;gap:20px;margin-bottom:24px}
.compare-wrap.visible{display:grid;grid-template-columns:1fr 1fr}
@media(max-width:720px){.compare-wrap.visible{grid-template-columns:1fr}}
.compare-col{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:24px;box-shadow:0 4px 30px #00000040,inset 0 1px 0 #ffffff05;display:flex;flex-direction:column;gap:14px}
.cmp-select{width:100%;padding:10px 12px;background:var(--bg);border:1px solid var(--border);border-radius:8px;color:var(--text);font-family:'Outfit',sans-serif;font-size:.84rem;cursor:pointer;outline:none;appearance:none;-webkit-appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' fill='none'%3E%3Cpath d='M1 1.5l5 5 5-5' stroke='%238887a0' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 12px center}
.cmp-select:focus{border-color:var(--pink);box-shadow:0 0 0 3px var(--pink-glow)}
.cmp-select option{background:var(--surface);color:var(--text)}
.cmp-star-info{display:flex;align-items:center;gap:12px}
.cmp-star-dot{width:28px;height:28px;border-radius:50%;flex-shrink:0}
.cmp-star-details{flex:1}
.cmp-star-name{font-weight:600;font-size:1rem;margin-bottom:2px}
.cmp-star-meta{font-size:.72rem;color:var(--text-dim);font-family:'JetBrains Mono',monospace}
.cmp-stats{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.cmp-stat{background:var(--bg);border-radius:8px;padding:10px 12px;text-align:center}
.cmp-stat-label{font-size:.62rem;color:var(--text-dim);letter-spacing:1px;text-transform:uppercase;margin-bottom:3px}
.cmp-stat-value{font-family:'JetBrains Mono',monospace;font-size:.92rem;font-weight:500}
.cmp-canvas-wrap{position:relative;width:100%;aspect-ratio:1/1;min-height:220px;border-radius:8px;overflow:hidden;background:var(--bg)}
.cmp-canvas-wrap canvas{width:100%;height:100%;display:block}
.cmp-planet-list{display:flex;flex-direction:column;gap:4px}
.cmp-planet{display:flex;align-items:center;gap:8px;padding:6px 10px;border-radius:6px;font-size:.78rem;background:var(--bg)}
.cmp-planet-dot{width:6px;height:6px;border-radius:50%;flex-shrink:0}
.cmp-planet-name{flex:1;font-weight:500}
.cmp-planet-dist{font-family:'JetBrains Mono',monospace;font-size:.72rem;color:var(--text-dim)}
.cmp-planet-hz{font-size:.68rem;font-weight:600}
/* Edu tooltips */
.info-tip{position:relative;display:inline-flex;align-items:center;gap:4px;cursor:help}
.info-icon{width:15px;height:15px;border-radius:50%;border:1px solid var(--text-faint);display:inline-flex;align-items:center;justify-content:center;font-size:9px;color:var(--text-faint);font-weight:700;flex-shrink:0;transition:all .2s}
.info-tip:hover .info-icon{border-color:var(--pink);color:var(--pink)}
.info-bubble{position:absolute;bottom:calc(100% + 10px);left:50%;transform:translateX(-50%);background:#181828ee;border:1px solid var(--border);border-radius:10px;padding:14px 16px;font-size:.78rem;color:var(--text);line-height:1.55;width:280px;pointer-events:none;opacity:0;transition:opacity .2s;box-shadow:0 8px 30px #000000a0;z-index:50;font-weight:400;letter-spacing:0}
.info-tip:hover .info-bubble{opacity:1;pointer-events:auto}
.info-bubble::after{content:'';position:absolute;top:100%;left:50%;transform:translateX(-50%);border:6px solid transparent;border-top-color:#181828ee}
/* Footer */
.footer{text-align:center;padding:40px 24px 30px;color:var(--text-faint);font-size:.75rem;letter-spacing:.5px;border-top:1px solid var(--border);margin-top:20px}
.footer-brand{font-weight:600;color:var(--text-dim)}
</style>
</head>
<body>
<div class="app">
  <div class="header">
    <div class="header-label">Nick's Astro Lab</div>
    <h1>Exoplanet Habitability Explorer</h1>
    <p class="subtitle">Explore real exoplanet systems. Calculate spectral class, luminosity, and habitable zones ‚Äî then watch the orbital diagram come alive.</p>
  </div>

  <div class="compare-toggle">
    <button class="active" id="modeExplore" onclick="setMode('explore')">Explore</button>
    <button id="modeCompare" onclick="setMode('compare')">Compare</button>
  </div>

  <div class="compare-wrap" id="compareWrap">
    <div class="compare-col" id="cmpCol0"></div>
    <div class="compare-col" id="cmpCol1"></div>
  </div>

  <div id="exploreWrap">
  <div class="panel">
    <div class="panel-title"><span class="info-tip">Star System<span class="info-icon">?</span><span class="info-bubble">Choose a real exoplanet system from the dropdown, or enter custom stellar parameters. The temperature and radius determine everything: spectral class, luminosity, and where liquid water could exist.</span></span></div>
    <div class="system-row">
      <label>Select a Known System</label>
      <select class="system-select" id="systemSelect" onchange="onSystemSelect()">
        <option value="custom">‚úé Custom Parameters</option>
        <option value="solar" selected>‚òÄ Solar System</option>
        <option value="trappist1">TRAPPIST-1 ‚Äî 7 planets, ultra-cool red dwarf</option>
        <option value="proxima">Proxima Centauri ‚Äî nearest star, 3 planets</option>
        <option value="kepler442">Kepler-442 ‚Äî habitable zone super-Earth</option>
        <option value="kepler186">Kepler-186 ‚Äî first Earth-size HZ planet</option>
        <option value="tauceti">Tau Ceti ‚Äî nearby Sun-like star</option>
        <option value="toi700">TOI-700 ‚Äî TESS discovery, 4 planets</option>
        <option value="lhs1140">LHS 1140 ‚Äî prime JWST target</option>
        <option value="hd40307">HD 40307 ‚Äî super-Earth system</option>
      </select>
    </div>
    <div class="divider">or enter custom values</div>
    <div class="input-grid">
      <div class="field"><label>Star Name</label><input type="text" id="starName" value="The Sun"></div>
      <div class="field"><label>Temperature <span>(K)</span></label><input type="number" id="starTemp" value="5778" min="1000" max="60000"></div>
      <div class="field"><label>Radius <span>(R‚òâ)</span></label><input type="number" id="starRadius" value="1.0" min="0.01" max="2000" step="0.01"></div>
    </div>
    <div class="slider-row">
      <label style="display:flex;justify-content:space-between;font-size:.76rem;font-weight:500;color:var(--text-dim);margin-bottom:6px">
        <span>Temperature Slider</span>
        <span id="sliderValue" style="font-family:'JetBrains Mono',monospace;color:var(--text)">5,778 K</span>
      </label>
      <input type="range" id="tempSlider" min="2500" max="40000" step="50" value="5778" oninput="onSliderMove(this.value)">
      <div style="display:flex;justify-content:space-between;font-size:.62rem;color:var(--text-faint);font-family:'JetBrains Mono',monospace;margin-top:3px">
        <span>2,500 K</span><span>M</span><span>K</span><span>G</span><span>F</span><span>A</span><span>B</span><span>O</span><span>40,000 K</span>
      </div>
    </div>
    <div class="btn-row">
      <button class="btn btn-primary" onclick="calculate()">Calculate</button>
      <button class="btn btn-random" onclick="randomStar()">üé≤ Random Star</button>
      <button class="btn btn-secondary" onclick="resetForm()">Reset</button>
    </div>
  </div>

  <div class="results" id="results">
    <div class="stat-grid">
      <div class="stat-card"><div class="stat-label"><span class="info-tip">Spectral Class<span class="info-icon">?</span><span class="info-bubble">Stars are classified O, B, A, F, G, K, M from hottest to coolest. Our Sun is a G-type star. The mnemonic: "Oh Be A Fine Girl/Guy, Kiss Me."</span></span></div><div id="spectralBadge" class="spectral-badge"></div><div class="stat-unit" id="spectralDesc"></div></div>
      <div class="stat-card"><div class="stat-label"><span class="info-tip">Luminosity<span class="info-icon">?</span><span class="info-bubble">How much energy the star emits, measured in solar luminosities (L‚òâ). Calculated from the Stefan-Boltzmann law: L = (R/R‚òâ)¬≤ √ó (T/T‚òâ)‚Å¥. This determines how far out the habitable zone extends.</span></span></div><div class="stat-value" id="luminosity"></div><div class="stat-unit">L‚òâ (solar luminosities)</div></div>
      <div class="stat-card"><div class="stat-label">Star Color</div><div class="stat-value" id="starColor"></div><div class="stat-unit" id="starColorName"></div></div>
    </div>

    <div class="orbital-wrap" id="orbitalWrap" style="display:none">
      <div class="orbital-header">
        <div class="orbital-title"><span class="info-tip">Orbital Diagram<span class="info-icon">?</span><span class="info-bubble">A top-down view of the system. The green ring is the habitable zone ‚Äî where liquid water could exist on a rocky planet. Planet speeds follow Kepler's laws: closer planets orbit faster.</span></span></div>
        <div class="orbital-controls">
          <button class="orbital-btn active" id="btnAnimate" onclick="toggleAnimation()">Animate</button>
          <button class="orbital-btn" id="btnLabels" onclick="toggleLabels()">Labels</button>
        </div>
      </div>
      <div class="orbital-canvas-wrap"><canvas id="orbitalCanvas"></canvas></div>
      <div class="orbital-legend">
        <div class="oleg"><div class="oleg-ring" style="border-color:#34d39980"></div>Habitable zone</div>
        <div class="oleg"><div class="oleg-dot" style="background:var(--green);box-shadow:0 0 6px var(--green)"></div>Planet in HZ</div>
        <div class="oleg"><div class="oleg-dot" style="background:var(--pink)"></div>Planet outside HZ</div>
      </div>
    </div>

    <div class="hz-bar">
      <div class="hz-item"><div class="hz-item-label"><span class="info-tip">HZ Inner Edge<span class="info-icon">?</span><span class="info-bubble">The closest distance to the star where a planet could maintain liquid water on its surface. Closer than this, a runaway greenhouse effect would boil oceans away (like Venus).</span></span></div><div class="hz-item-value" id="hzInner" style="color:#f47240"></div></div>
      <div class="hz-item"><div class="hz-item-label">HZ Center</div><div class="hz-item-value" id="hzCenter" style="color:#34d399"></div></div>
      <div class="hz-item"><div class="hz-item-label"><span class="info-tip">HZ Outer Edge<span class="info-icon">?</span><span class="info-bubble">The farthest distance where a planet with a thick CO‚ÇÇ atmosphere could still maintain liquid water. Beyond this, even a strong greenhouse effect can't prevent freezing (like Mars).</span></span></div><div class="hz-item-value" id="hzOuter" style="color:#67a8f9"></div></div>
    </div>

    <div class="planet-table-wrap" id="planetTableWrap">
      <div class="panel-title" id="planetTableTitle">Known Planets</div>
      <table class="planet-table">
        <thead><tr><th>Planet</th><th>Distance (AU)</th><th>Radius (R‚äï)</th><th>Mass (M‚äï)</th><th>In Habitable Zone?</th></tr></thead>
        <tbody id="planetTableBody"></tbody>
      </table>
    </div>

    <!-- ANALYTICS SECTION -->
    <div class="summary-stat" id="summaryWrap">
      <div class="summary-big" id="summaryPct"></div>
      <div class="summary-label" id="summaryText"></div>
    </div>

    <div class="charts-row">
      <div class="chart-panel">
        <div class="chart-header"><div class="chart-title"><span class="info-tip">HZ Width Comparison<span class="info-icon">?</span><span class="info-bubble">Compares how wide the habitable zone is for each star system. Hotter, brighter stars have wider zones, giving planets more room to be potentially habitable.</span></span></div></div>
        <div class="chart-canvas-wrap" style="height:320px"><canvas id="barChart"></canvas></div>
      </div>
      <div class="chart-panel">
        <div class="chart-header"><div class="chart-title"><span class="info-tip">Planet Habitability Map<span class="info-icon">?</span><span class="info-bubble">Every planet plotted by its distance from the HZ center (x-axis, normalized) and radius (y-axis). Planets inside the green band are in the habitable zone. An ideal Earth twin would sit at x=1.0 and y=1.0.</span></span></div></div>
        <div class="chart-canvas-wrap" style="height:320px"><canvas id="scatterChart"></canvas></div>
      </div>
    </div>

    <div class="chart-panel">
      <div class="chart-header">
        <div class="chart-title"><span class="info-tip">Hertzsprung‚ÄìRussell Diagram<span class="info-icon">?</span><span class="info-bubble">The most important diagram in astrophysics. It plots star temperature vs luminosity. Main sequence stars (like our Sun) fall on a diagonal band. A star's position reveals its age, size, and fate.</span></span></div>
        <div class="chart-sub">Click a star to explore its system</div>
      </div>
      <div class="chart-canvas-wrap" style="height:420px"><canvas id="hrCanvas"></canvas></div>
      <div class="chart-legend">
        <div class="cleg"><div class="cleg-dot" style="background:#9bb0ff"></div>O/B</div>
        <div class="cleg"><div class="cleg-dot" style="background:#cad7ff"></div>A</div>
        <div class="cleg"><div class="cleg-dot" style="background:#fff4ea"></div>G</div>
        <div class="cleg"><div class="cleg-dot" style="background:#ffd2a1"></div>K</div>
        <div class="cleg"><div class="cleg-dot" style="background:#ffac6b"></div>M</div>
        <div class="cleg" style="margin-left:8px;border-left:1px solid var(--border);padding-left:12px"><div style="width:10px;height:10px;border:2px solid var(--pink);border-radius:50%"></div>Selected</div>
        <div class="cleg"><div style="width:20px;height:6px;background:linear-gradient(90deg,#9bb0ff18,#fff4ea18,#ffac6b18);border-radius:3px"></div>Main sequence</div>
      </div>
    </div>

  </div>
  </div><!-- end exploreWrap -->
</div>

<footer class="footer">
  Built with physics and code ¬∑ <span class="footer-brand">An MVP Production</span>
</footer>

<script>
const T_SUN=5778;
const SYSTEMS={
  solar:{star_name:"The Sun",star_temp_K:5778,star_radius_solar:1.0,distance_ly:0,planets:[
    {name:"Mercury",orbital_distance_AU:0.387,radius_earth:0.383,mass_earth:0.055},
    {name:"Venus",orbital_distance_AU:0.723,radius_earth:0.949,mass_earth:0.815},
    {name:"Earth",orbital_distance_AU:1.000,radius_earth:1.000,mass_earth:1.000},
    {name:"Mars",orbital_distance_AU:1.524,radius_earth:0.532,mass_earth:0.107}]},
  trappist1:{star_name:"TRAPPIST-1",star_temp_K:2566,star_radius_solar:0.121,distance_ly:39.6,planets:[
    {name:"TRAPPIST-1 b",orbital_distance_AU:0.01154,radius_earth:1.116,mass_earth:1.374},
    {name:"TRAPPIST-1 c",orbital_distance_AU:0.01580,radius_earth:1.097,mass_earth:1.308},
    {name:"TRAPPIST-1 d",orbital_distance_AU:0.02228,radius_earth:0.788,mass_earth:0.388},
    {name:"TRAPPIST-1 e",orbital_distance_AU:0.02928,radius_earth:0.920,mass_earth:0.692},
    {name:"TRAPPIST-1 f",orbital_distance_AU:0.03853,radius_earth:1.045,mass_earth:1.039},
    {name:"TRAPPIST-1 g",orbital_distance_AU:0.04688,radius_earth:1.129,mass_earth:1.321},
    {name:"TRAPPIST-1 h",orbital_distance_AU:0.06193,radius_earth:0.755,mass_earth:0.326}]},
  proxima:{star_name:"Proxima Centauri",star_temp_K:3042,star_radius_solar:0.1542,distance_ly:4.24,planets:[
    {name:"Proxima Cen d",orbital_distance_AU:0.02885,radius_earth:0.81,mass_earth:0.26},
    {name:"Proxima Cen b",orbital_distance_AU:0.04857,radius_earth:1.03,mass_earth:1.07},
    {name:"Proxima Cen c",orbital_distance_AU:1.489,radius_earth:3.42,mass_earth:7.0}]},
  kepler442:{star_name:"Kepler-442",star_temp_K:4402,star_radius_solar:0.598,distance_ly:1206,planets:[
    {name:"Kepler-442 b",orbital_distance_AU:0.409,radius_earth:1.34,mass_earth:2.36}]},
  kepler186:{star_name:"Kepler-186",star_temp_K:3788,star_radius_solar:0.472,distance_ly:582,planets:[
    {name:"Kepler-186 b",orbital_distance_AU:0.0378,radius_earth:1.07,mass_earth:null},
    {name:"Kepler-186 c",orbital_distance_AU:0.0451,radius_earth:1.25,mass_earth:null},
    {name:"Kepler-186 d",orbital_distance_AU:0.0781,radius_earth:1.40,mass_earth:null},
    {name:"Kepler-186 e",orbital_distance_AU:0.110,radius_earth:1.27,mass_earth:null},
    {name:"Kepler-186 f",orbital_distance_AU:0.432,radius_earth:1.17,mass_earth:null}]},
  tauceti:{star_name:"Tau Ceti",star_temp_K:5344,star_radius_solar:0.793,distance_ly:11.9,planets:[
    {name:"Tau Ceti e",orbital_distance_AU:0.538,radius_earth:null,mass_earth:3.93},
    {name:"Tau Ceti f",orbital_distance_AU:1.334,radius_earth:null,mass_earth:3.93}]},
  toi700:{star_name:"TOI-700",star_temp_K:3482,star_radius_solar:0.420,distance_ly:101.4,planets:[
    {name:"TOI-700 b",orbital_distance_AU:0.0637,radius_earth:1.001,mass_earth:1.07},
    {name:"TOI-700 c",orbital_distance_AU:0.0929,radius_earth:2.63,mass_earth:null},
    {name:"TOI-700 e",orbital_distance_AU:0.134,radius_earth:0.953,mass_earth:0.818},
    {name:"TOI-700 d",orbital_distance_AU:0.163,radius_earth:1.073,mass_earth:1.25}]},
  lhs1140:{star_name:"LHS 1140",star_temp_K:3216,star_radius_solar:0.2139,distance_ly:48.8,planets:[
    {name:"LHS 1140 c",orbital_distance_AU:0.02675,radius_earth:1.272,mass_earth:1.81},
    {name:"LHS 1140 b",orbital_distance_AU:0.0946,radius_earth:1.730,mass_earth:5.60}]},
  hd40307:{star_name:"HD 40307",star_temp_K:4977,star_radius_solar:0.716,distance_ly:42,planets:[
    {name:"HD 40307 b",orbital_distance_AU:0.0468,radius_earth:null,mass_earth:4.0},
    {name:"HD 40307 c",orbital_distance_AU:0.0799,radius_earth:null,mass_earth:6.6},
    {name:"HD 40307 d",orbital_distance_AU:0.1321,radius_earth:null,mass_earth:9.5},
    {name:"HD 40307 g",orbital_distance_AU:0.600,radius_earth:null,mass_earth:7.1}]}
};

let currentPlanets=null,animating=true,showLabels=true,animFrame=null,orbitalState=null;
let mouseX=-1,mouseY=-1,hoveredPlanet=null,compareMode=false;
let cmpAnimFrames=[null,null],cmpStates=[null,null],cmpMouse=[{x:-1,y:-1,hovered:null},{x:-1,y:-1,hovered:null}];
const cmpDefaults=['solar','trappist1'];

function classifyStar(t){
  if(t>30000)return{cls:'O',color:'#9bb0ff',name:'Blue',desc:'Rare, massive, short-lived',bg:'#9bb0ff20',border:'#9bb0ff50'};
  if(t>=10000)return{cls:'B',color:'#aabfff',name:'Blue-white',desc:'Hot and luminous',bg:'#aabfff20',border:'#aabfff50'};
  if(t>=7500)return{cls:'A',color:'#cad7ff',name:'White',desc:'Strong hydrogen lines',bg:'#cad7ff20',border:'#cad7ff50'};
  if(t>=6000)return{cls:'F',color:'#f8f7ff',name:'Yellow-white',desc:'Slightly hotter than Sun',bg:'#f8f7ff20',border:'#f8f7ff50'};
  if(t>=5200)return{cls:'G',color:'#fff4ea',name:'Yellow',desc:'Sun-like star',bg:'#fff4ea20',border:'#fff4ea50'};
  if(t>=3700)return{cls:'K',color:'#ffd2a1',name:'Orange',desc:'Cooler, long-lived',bg:'#ffd2a120',border:'#ffd2a150'};
  return{cls:'M',color:'#ffac6b',name:'Red',desc:'Red dwarf, most common',bg:'#ffac6b20',border:'#ffac6b50'};
}

function getLum(t,r){return r**2*(t/T_SUN)**4}
function getHZ(lum){return{inner:Math.sqrt(lum)*0.95,outer:Math.sqrt(lum)*1.37}}

function onSystemSelect(){
  const v=document.getElementById('systemSelect').value;
  if(v==='custom'){currentPlanets=null;['starName','starTemp','starRadius'].forEach(i=>document.getElementById(i).value='');document.getElementById('starName').focus();return}
  const s=SYSTEMS[v];if(!s)return;
  document.getElementById('starName').value=s.star_name;
  document.getElementById('starTemp').value=s.star_temp_K;
  document.getElementById('starRadius').value=s.star_radius_solar;
  currentPlanets=s.planets;syncSliderToInput();calculate();
}

let sliderTimeout=null;
function onSliderMove(val){val=parseInt(val);document.getElementById('starTemp').value=val;document.getElementById('sliderValue').textContent=val.toLocaleString()+' K';document.getElementById('systemSelect').value='custom';clearTimeout(sliderTimeout);sliderTimeout=setTimeout(()=>calculate(),30)}
function syncSliderToInput(){const v=parseFloat(document.getElementById('starTemp').value);if(!isNaN(v)){const c=Math.max(2500,Math.min(40000,v));document.getElementById('tempSlider').value=c;document.getElementById('sliderValue').textContent=Math.round(c).toLocaleString()+' K'}}
['starName','starRadius'].forEach(id=>document.getElementById(id).addEventListener('input',()=>{document.getElementById('systemSelect').value='custom';currentPlanets=null}));
document.getElementById('starTemp').addEventListener('input',()=>{document.getElementById('systemSelect').value='custom';currentPlanets=null;syncSliderToInput()});

function toggleAnimation(){animating=!animating;document.getElementById('btnAnimate').classList.toggle('active',animating)}
function toggleLabels(){showLabels=!showLabels;document.getElementById('btnLabels').classList.toggle('active',showLabels)}

function randomStar(){
  const names=['Aethon','Pyxis','Velorum','Zephyria','Kaelith','Thandros','Myrvane','Solteris','Dravonis','Lumara','Cygnar','Erythea','Calyx','Novastra','Stellion'];
  const name=names[Math.floor(Math.random()*names.length)]+'-'+Math.floor(Math.random()*900+100);
  const temp=Math.round(2500+Math.random()*37500);
  const radius=Math.round((0.08+Math.random()*4)*100)/100;
  document.getElementById('systemSelect').value='custom';
  document.getElementById('starName').value=name;
  document.getElementById('starTemp').value=temp;
  document.getElementById('starRadius').value=radius;
  currentPlanets=null;syncSliderToInput();calculate();
}

function calculate(){
  const name=document.getElementById('starName').value||'Unknown';
  const temp=parseFloat(document.getElementById('starTemp').value);
  const radius=parseFloat(document.getElementById('starRadius').value);
  if(isNaN(temp)||isNaN(radius)||temp<=0||radius<=0)return;
  const lum=getLum(temp,radius);
  const hz=getHZ(lum);
  const spec=classifyStar(temp);
  const b=document.getElementById('spectralBadge');
  b.textContent=spec.cls;b.style.background=spec.bg;b.style.border=`1px solid ${spec.border}`;b.style.color=spec.color;
  document.getElementById('spectralDesc').textContent=spec.desc;
  const lE=document.getElementById('luminosity');
  lE.textContent=lum>=1000?lum.toExponential(2):lum>=1?lum.toFixed(2):lum>=0.001?lum.toFixed(4):lum.toExponential(2);
  lE.style.color=spec.color;
  document.getElementById('starColor').innerHTML=`<span style="display:inline-block;width:18px;height:18px;border-radius:50%;background:${spec.color};vertical-align:middle;box-shadow:0 0 10px ${spec.color}80;margin-right:7px"></span>${temp.toLocaleString()} K`;
  document.getElementById('starColorName').textContent=spec.name;
  const f=v=>v>=10?v.toFixed(1):v>=0.1?v.toFixed(3):v.toFixed(4);
  document.getElementById('hzInner').textContent=f(hz.inner)+' AU';
  document.getElementById('hzCenter').textContent=f((hz.inner+hz.outer)/2)+' AU';
  document.getElementById('hzOuter').textContent=f(hz.outer)+' AU';
  buildPlanetTable(name,hz.inner,hz.outer,currentPlanets);
  const sk=document.getElementById('systemSelect').value;
  const distLy=sk!=='custom'&&SYSTEMS[sk]?SYSTEMS[sk].distance_ly:null;
  initOrbitalDiagram(spec,hz.inner,hz.outer,currentPlanets,distLy);
  drawBarChart();drawScatterChart();drawSummary();
  drawHRDiagram(sk==='custom'?null:sk);
  document.getElementById('results').classList.add('visible');
}

// ===== ORBITAL DIAGRAM =====
function initOrbitalDiagram(spec,hzI,hzO,planets,distLy){
  const w=document.getElementById('orbitalWrap');
  if(!planets||!planets.length){w.style.display='none';if(animFrame)cancelAnimationFrame(animFrame);return}
  w.style.display='block';
  const canvas=document.getElementById('orbitalCanvas');const cw=canvas.parentElement;
  const dpr=window.devicePixelRatio||1;const W=cw.offsetWidth,H=cw.offsetHeight;
  canvas.width=W*dpr;canvas.height=H*dpr;canvas.style.width=W+'px';canvas.style.height=H+'px';
  const ctx=canvas.getContext('2d');ctx.setTransform(dpr,0,0,dpr,0,0);
  const cx=W/2,cy=H/2;
  const maxDist=Math.max(hzO*1.3,...planets.map(p=>p.orbital_distance_AU));
  const scale=(Math.min(W,H)/2-50)/maxDist;
  const pData=planets.map(p=>({...p,inHz:p.orbital_distance_AU>=hzI&&p.orbital_distance_AU<=hzO,angle:Math.random()*Math.PI*2,speed:0.3/Math.sqrt(p.orbital_distance_AU/planets[0].orbital_distance_AU),trail:[],trailMax:p.orbital_distance_AU>=hzI&&p.orbital_distance_AU<=hzO?60:30}));
  canvas.onmousemove=function(e){const r=canvas.getBoundingClientRect();mouseX=e.clientX-r.left;mouseY=e.clientY-r.top};
  canvas.onmouseleave=function(){mouseX=-1;mouseY=-1;hoveredPlanet=null;canvas.style.cursor='default'};
  let tip=document.getElementById('orbitalTooltip');
  if(!tip){tip=document.createElement('div');tip.id='orbitalTooltip';tip.style.cssText='position:absolute;pointer-events:none;opacity:0;transition:opacity .15s;z-index:20;background:#12121cee;border:1px solid #2a2a44;border-radius:10px;padding:14px 18px;font-family:Outfit,sans-serif;font-size:.82rem;color:#e0dff0;box-shadow:0 8px 30px #000000a0;min-width:180px';cw.appendChild(tip)}
  orbitalState={spec,hzInner:hzI,hzOuter:hzO,planets:pData,cx,cy,scale,W,H,ctx,canvas,dpr,startTime:performance.now(),distLy:distLy};
  if(animFrame)cancelAnimationFrame(animFrame);renderOrbital();
}

function renderOrbital(){
  const s=orbitalState;if(!s)return;
  const{ctx,W,H,cx,cy,scale,spec,hzInner,hzOuter,planets}=s;const t=(performance.now()-s.startTime)/1000;
  ctx.clearRect(0,0,W,H);
  const bgG=ctx.createRadialGradient(cx,cy,0,cx,cy,Math.min(W,H)/2);
  bgG.addColorStop(0,spec.color+'08');bgG.addColorStop(1,'transparent');ctx.fillStyle=bgG;ctx.fillRect(0,0,W,H);
  const hzInPx=Math.max(0,hzInner*scale),hzOutPx=Math.max(0,hzOuter*scale);
  ctx.save();ctx.beginPath();ctx.arc(cx,cy,hzOutPx,0,Math.PI*2);if(hzInPx>0)ctx.arc(cx,cy,hzInPx,0,Math.PI*2,true);ctx.closePath();
  const hzG=ctx.createRadialGradient(cx,cy,hzInPx,cx,cy,hzOutPx);hzG.addColorStop(0,'#34d39918');hzG.addColorStop(1,'#34d39908');ctx.fillStyle=hzG;ctx.fill();
  ctx.beginPath();ctx.arc(cx,cy,Math.max(0,hzInPx),0,Math.PI*2);ctx.strokeStyle='#34d39925';ctx.lineWidth=1;ctx.setLineDash([4,6]);ctx.stroke();
  ctx.beginPath();ctx.arc(cx,cy,Math.max(0,hzOutPx),0,Math.PI*2);ctx.stroke();ctx.setLineDash([]);ctx.restore();
  planets.forEach(p=>{const r=Math.max(0,p.orbital_distance_AU*scale);ctx.beginPath();ctx.arc(cx,cy,r,0,Math.PI*2);ctx.strokeStyle=p.inHz?'#34d39920':'#ffffff0c';ctx.lineWidth=1;ctx.stroke()});
  planets.forEach(p=>{if(animating)p.angle+=p.speed*0.016;const r=Math.max(0,p.orbital_distance_AU*scale);const px=cx+Math.cos(p.angle)*r,py=cy+Math.sin(p.angle)*r;p.trail.push({x:px,y:py,age:0});if(p.trail.length>p.trailMax)p.trail.shift();p.trail.forEach(pt=>pt.age++)});
  planets.forEach(p=>{if(p.trail.length<2)return;for(let i=1;i<p.trail.length;i++){const a=1-(p.trail[i].age/p.trailMax);if(a<=0)continue;const al=a*a*(p.inHz?0.6:0.2);ctx.beginPath();ctx.moveTo(p.trail[i-1].x,p.trail[i-1].y);ctx.lineTo(p.trail[i].x,p.trail[i].y);ctx.strokeStyle=p.inHz?`rgba(52,211,153,${al})`:`rgba(244,114,182,${al})`;ctx.lineWidth=p.inHz?3:1.5;ctx.lineCap='round';ctx.stroke()}});
  const starR=Math.max(8,Math.min(22,spec.cls==='M'||spec.cls==='K'?8:14));
  const sp=0.7+0.3*Math.sin(t*1.5),sp2=0.8+0.2*Math.sin(t*2.3+0.5);
  for(let i=4;i>=0;i--){const gs=Math.max(0.1,starR+i*18*sp2);const gr=ctx.createRadialGradient(cx,cy,0,cx,cy,gs);const a=i===0?'ff':i===1?Math.round(48*sp).toString(16).padStart(2,'0'):Math.round(20*sp).toString(16).padStart(2,'0');gr.addColorStop(0,spec.color+a);gr.addColorStop(0.3,spec.color+(i<2?Math.round(40*sp).toString(16).padStart(2,'0'):'08'));gr.addColorStop(1,'transparent');ctx.fillStyle=gr;ctx.beginPath();ctx.arc(cx,cy,gs,0,Math.PI*2);ctx.fill()}
  const cR=Math.max(0.1,starR*(0.95+0.05*Math.sin(t*1.5)));const sg=ctx.createRadialGradient(cx,cy,0,cx,cy,cR);sg.addColorStop(0,'#fff');sg.addColorStop(0.3,spec.color);sg.addColorStop(1,spec.color+'80');ctx.fillStyle=sg;ctx.beginPath();ctx.arc(cx,cy,cR,0,Math.PI*2);ctx.fill();
  hoveredPlanet=null;
  planets.forEach((p,i)=>{
    const r=Math.max(0,p.orbital_distance_AU*scale);const px=cx+Math.cos(p.angle)*r,py=cy+Math.sin(p.angle)*r;
    const isH=mouseX>=0&&((mouseX-px)**2+(mouseY-py)**2<=18*18);if(isH)hoveredPlanet=p;
    const dR=(p.inHz?5:3.5)*(isH?1.8:1);
    if(p.inHz){const pu=0.5+0.5*Math.sin(t*2+i);for(let g=3;g>=0;g--){const gR=Math.max(0.1,dR+g*6);const gg=ctx.createRadialGradient(px,py,0,px,py,gR);gg.addColorStop(0,`rgba(52,211,153,${0.15*pu})`);gg.addColorStop(1,'transparent');ctx.fillStyle=gg;ctx.beginPath();ctx.arc(px,py,gR,0,Math.PI*2);ctx.fill()}}
    const pg=ctx.createRadialGradient(px,py,0,px,py,Math.max(0.1,dR));if(p.inHz){pg.addColorStop(0,'#fff');pg.addColorStop(0.4,'#34d399');pg.addColorStop(1,'#34d39980')}else{pg.addColorStop(0,'#fff');pg.addColorStop(0.4,'#f472b6');pg.addColorStop(1,'#f472b680')}
    ctx.fillStyle=pg;ctx.beginPath();ctx.arc(px,py,Math.max(0.1,dR),0,Math.PI*2);ctx.fill();
    if(showLabels){ctx.save();ctx.font="500 10px 'Outfit',sans-serif";ctx.textAlign='center';const ln=p.name.split(' ').pop();ctx.fillStyle=p.inHz?'#34d399cc':'#f472b6aa';ctx.fillText(ln,px+Math.cos(p.angle)*(dR+12),py+Math.sin(p.angle)*(dR+12)+3);ctx.restore()}
  });
  // === EARTH DIRECTION ARROW (top-right) ===
  if(s.distLy!=null&&s.distLy>0){
    ctx.save();
    const ax=W-28,ay=32;// anchor point top-right
    const arrowLen=32;
    // Arrow pointing up-right (toward Earth conceptually)
    const aAngle=-Math.PI/4+0.08*Math.sin(t*0.5);// subtle sway
    const tipX=ax,tipY=ay;
    const tailX=tipX-Math.cos(aAngle)*arrowLen,tailY=tipY+Math.sin(aAngle)*arrowLen;
    // Glow
    ctx.beginPath();ctx.moveTo(tailX,tailY);ctx.lineTo(tipX,tipY);
    ctx.strokeStyle='#67e8f930';ctx.lineWidth=6;ctx.lineCap='round';ctx.stroke();
    // Arrow shaft
    ctx.beginPath();ctx.moveTo(tailX,tailY);ctx.lineTo(tipX,tipY);
    ctx.strokeStyle='#67e8f9aa';ctx.lineWidth=1.5;ctx.lineCap='round';ctx.stroke();
    // Arrowhead
    const headLen=8,headAng=0.45;
    ctx.beginPath();
    ctx.moveTo(tipX-Math.cos(aAngle-headAng)*headLen,tipY+Math.sin(aAngle-headAng)*headLen);
    ctx.lineTo(tipX,tipY);
    ctx.lineTo(tipX-Math.cos(aAngle+headAng)*headLen,tipY+Math.sin(aAngle+headAng)*headLen);
    ctx.strokeStyle='#67e8f9cc';ctx.lineWidth=1.5;ctx.stroke();
    // Earth icon (tiny circle)
    ctx.beginPath();ctx.arc(tipX+5,tipY-5,3,0,Math.PI*2);
    ctx.fillStyle='#67e8f960';ctx.fill();
    ctx.beginPath();ctx.arc(tipX+5,tipY-5,3,0,Math.PI*2);
    ctx.strokeStyle='#67e8f9aa';ctx.lineWidth=0.8;ctx.stroke();
    // Distance text
    const distStr=s.distLy<100?s.distLy.toFixed(1)+' ly':Math.round(s.distLy).toLocaleString()+' ly';
    ctx.font="600 9px 'JetBrains Mono',monospace";ctx.fillStyle='#67e8f9aa';ctx.textAlign='right';
    ctx.fillText('‚Üí Earth',ax-4,ay+arrowLen+14);
    ctx.font="500 9px 'JetBrains Mono',monospace";ctx.fillStyle='#67e8f970';
    ctx.fillText(distStr,ax-4,ay+arrowLen+26);
    ctx.restore();
  }else if(s.distLy===0){
    // Solar system ‚Äî we ARE here
    ctx.save();
    ctx.font="600 9px 'JetBrains Mono',monospace";ctx.fillStyle='#67e8f9aa';ctx.textAlign='right';
    ctx.fillText('‚äï You are here',W-20,28);
    ctx.restore();
  }
  const tip=document.getElementById('orbitalTooltip');const canvas=s.canvas;
  if(tip){if(hoveredPlanet){const p=hoveredPlanet;tip.innerHTML=`<div style="font-weight:600;font-size:.95rem;margin-bottom:8px;color:${p.inHz?'#34d399':'#f472b6'}">${p.name}</div><div style="display:grid;grid-template-columns:auto 1fr;gap:4px 12px;font-size:.78rem;line-height:1.7"><span style="color:#8887a0">Distance</span><span style="font-family:'JetBrains Mono',monospace">${p.orbital_distance_AU} AU</span><span style="color:#8887a0">Radius</span><span style="font-family:'JetBrains Mono',monospace">${p.radius_earth!=null?p.radius_earth.toFixed(3)+' R‚äï':'Unknown'}</span><span style="color:#8887a0">Mass</span><span style="font-family:'JetBrains Mono',monospace">${p.mass_earth!=null?p.mass_earth.toFixed(2)+' M‚äï':'Unknown'}</span></div><div style="margin-top:8px;padding-top:8px;border-top:1px solid #1e1e34;font-size:.78rem">${p.inHz?'<span style="color:#34d399">‚óè In Habitable Zone</span>':'<span style="color:#f87171">‚óã Outside HZ</span>'}</div>`;const r=Math.max(0,p.orbital_distance_AU*scale);const ppx=cx+Math.cos(p.angle)*r,ppy=cy+Math.sin(p.angle)*r;let tx=ppx+16,ty=ppy-tip.offsetHeight-8;if(tx+tip.offsetWidth>W-10)tx=ppx-tip.offsetWidth-16;if(ty<10)ty=ppy+20;tip.style.left=tx+'px';tip.style.top=ty+'px';tip.style.opacity='1';canvas.style.cursor='pointer'}else{tip.style.opacity='0';canvas.style.cursor='default'}}
  animFrame=requestAnimationFrame(renderOrbital);
}

function buildPlanetTable(starName,hzI,hzO,planets){
  const wrap=document.getElementById('planetTableWrap'),body=document.getElementById('planetTableBody'),title=document.getElementById('planetTableTitle');
  if(!planets||!planets.length){wrap.classList.remove('visible');return}
  const hzN=planets.filter(p=>p.orbital_distance_AU>=hzI&&p.orbital_distance_AU<=hzO).length;
  title.innerHTML=`Known Planets<span class="badge badge-pink">${planets.length}</span>`+(hzN?`<span class="badge badge-green">${hzN} in HZ</span>`:'');
  let rows='';
  planets.forEach(p=>{const inHz=p.orbital_distance_AU>=hzI&&p.orbital_distance_AU<=hzO;const rS=p.radius_earth!=null?p.radius_earth.toFixed(3):'<span class="unknown">Unknown</span>';const mS=p.mass_earth!=null?p.mass_earth.toFixed(2):'<span class="unknown">Unknown</span>';const pipCol=inHz?'var(--green)':'var(--pink)';const hzS=inHz?`<span class="hz-yes"><span class="hz-status-pip" style="background:var(--green)"></span>Yes ‚Äî Habitable</span>`:`<span class="hz-no"><span class="hz-status-pip" style="background:var(--red)"></span>No</span>`;rows+=`<tr class="${inHz?'hz-row':''}"><td><div class="planet-name-cell"><span class="planet-pip" style="background:${pipCol};box-shadow:0 0 4px ${pipCol}"></span>${p.name}</div></td><td>${p.orbital_distance_AU}</td><td>${rS}</td><td>${mS}</td><td>${hzS}</td></tr>`});
  body.innerHTML=rows;wrap.classList.add('visible');
}

// ===== BAR CHART: HZ WIDTH COMPARISON =====
function drawBarChart(){
  const canvas=document.getElementById('barChart');if(!canvas)return;
  const cw=canvas.parentElement;const dpr=window.devicePixelRatio||1;
  const W=cw.offsetWidth,H=cw.offsetHeight;canvas.width=W*dpr;canvas.height=H*dpr;canvas.style.width=W+'px';canvas.style.height=H+'px';
  const ctx=canvas.getContext('2d');ctx.setTransform(dpr,0,0,dpr,0,0);
  const pad={t:20,r:20,b:60,l:55};const pw=W-pad.l-pad.r,ph=H-pad.t-pad.b;
  const data=Object.keys(SYSTEMS).map(k=>{const s=SYSTEMS[k];const l=getLum(s.star_temp_K,s.star_radius_solar);const hz=getHZ(l);return{name:s.star_name.replace('Proxima Centauri','Proxima').replace('The ',''),width:hz.outer-hz.inner,spec:classifyStar(s.star_temp_K),key:k}}).sort((a,b)=>b.width-a.width);
  const maxW=Math.max(...data.map(d=>d.width));
  const barW=Math.min(40,pw/data.length-8);const gap=(pw-barW*data.length)/(data.length+1);
  const selKey=document.getElementById('systemSelect').value;

  ctx.clearRect(0,0,W,H);
  // Grid
  for(let i=0;i<=4;i++){const y=pad.t+ph-ph*(i/4);ctx.beginPath();ctx.moveTo(pad.l,y);ctx.lineTo(pad.l+pw,y);ctx.strokeStyle='#ffffff08';ctx.lineWidth=1;ctx.stroke();ctx.font="500 9px 'JetBrains Mono',monospace";ctx.fillStyle='#8887a0';ctx.textAlign='right';ctx.fillText((maxW*i/4).toFixed(2),pad.l-8,y+3)}
  ctx.save();ctx.translate(14,pad.t+ph/2);ctx.rotate(-Math.PI/2);ctx.font="500 9px 'Outfit',sans-serif";ctx.fillStyle='#8887a060';ctx.textAlign='center';ctx.fillText('HZ Width (AU)',0,0);ctx.restore();

  data.forEach((d,i)=>{
    const x=pad.l+gap+(barW+gap)*i;const bH=Math.max(2,(d.width/maxW)*ph);const y=pad.t+ph-bH;
    const isSel=d.key===selKey;
    const g=ctx.createLinearGradient(x,y,x,y+bH);g.addColorStop(0,d.spec.color+(isSel?'cc':'66'));g.addColorStop(1,d.spec.color+(isSel?'40':'18'));
    ctx.fillStyle=g;
    ctx.beginPath();const r=Math.min(4,barW/2);ctx.moveTo(x,y+r);ctx.arcTo(x,y,x+barW,y,r);ctx.arcTo(x+barW,y,x+barW,y+bH,r);ctx.lineTo(x+barW,y+bH);ctx.lineTo(x,y+bH);ctx.closePath();ctx.fill();
    if(isSel){ctx.strokeStyle=d.spec.color+'aa';ctx.lineWidth=1.5;ctx.stroke()}
    // Value on top
    ctx.font="500 8px 'JetBrains Mono',monospace";ctx.fillStyle=d.spec.color+'cc';ctx.textAlign='center';
    ctx.fillText(d.width.toFixed(3),x+barW/2,y-6);
    // Label
    ctx.save();ctx.translate(x+barW/2,pad.t+ph+12);ctx.rotate(-0.5);ctx.font="500 8px 'Outfit',sans-serif";ctx.fillStyle=isSel?'#fff':'#8887a0';ctx.textAlign='left';ctx.fillText(d.name,0,0);ctx.restore();
  });
}

// ===== SCATTER CHART: PLANET HABITABILITY MAP =====
function drawScatterChart(){
  const canvas=document.getElementById('scatterChart');if(!canvas)return;
  const cw=canvas.parentElement;const dpr=window.devicePixelRatio||1;
  const W=cw.offsetWidth,H=cw.offsetHeight;canvas.width=W*dpr;canvas.height=H*dpr;canvas.style.width=W+'px';canvas.style.height=H+'px';
  const ctx=canvas.getContext('2d');ctx.setTransform(dpr,0,0,dpr,0,0);
  const pad={t:20,r:20,b:45,l:50};const pw=W-pad.l-pad.r,ph=H-pad.t-pad.b;

  // Build planet data normalized to HZ center
  const allP=[];
  Object.values(SYSTEMS).forEach(s=>{
    const l=getLum(s.star_temp_K,s.star_radius_solar);const hz=getHZ(l);const c=(hz.inner+hz.outer)/2;
    s.planets.forEach(p=>{if(p.radius_earth==null)return;const norm=p.orbital_distance_AU/c;const inHz=p.orbital_distance_AU>=hz.inner&&p.orbital_distance_AU<=hz.outer;allP.push({name:p.name,normDist:norm,radius:p.radius_earth,inHz})});
  });
  if(!allP.length)return;

  const xMin=0,xMax=Math.max(3,...allP.map(p=>p.normDist*1.1));
  const yMax=Math.max(2,...allP.map(p=>p.radius*1.2));
  const x2px=v=>pad.l+(v/xMax)*pw;const y2px=v=>pad.t+ph-(v/yMax)*ph;
  // HZ band normalized: inner=0.95/((0.95+1.37)/2)‚âà0.819, outer‚âà1.181
  const hzNormI=0.95/1.16,hzNormO=1.37/1.16;

  ctx.clearRect(0,0,W,H);
  // HZ band
  const bx1=x2px(hzNormI),bx2=x2px(hzNormO);
  ctx.fillStyle='#34d39912';ctx.fillRect(bx1,pad.t,bx2-bx1,ph);
  ctx.strokeStyle='#34d39930';ctx.lineWidth=1;ctx.setLineDash([3,4]);
  ctx.beginPath();ctx.moveTo(bx1,pad.t);ctx.lineTo(bx1,pad.t+ph);ctx.stroke();
  ctx.beginPath();ctx.moveTo(bx2,pad.t);ctx.lineTo(bx2,pad.t+ph);ctx.stroke();ctx.setLineDash([]);
  ctx.font="600 8px 'Outfit',sans-serif";ctx.fillStyle='#34d39940';ctx.textAlign='center';ctx.fillText('HABITABLE ZONE',(bx1+bx2)/2,pad.t+14);
  // Center line
  const cx1=x2px(1.0);ctx.beginPath();ctx.moveTo(cx1,pad.t);ctx.lineTo(cx1,pad.t+ph);ctx.strokeStyle='#34d39950';ctx.lineWidth=1;ctx.setLineDash([2,3]);ctx.stroke();ctx.setLineDash([]);
  // Earth ref
  const ey=y2px(1.0);ctx.beginPath();ctx.moveTo(pad.l,ey);ctx.lineTo(pad.l+pw,ey);ctx.strokeStyle='#ffffff10';ctx.lineWidth=1;ctx.setLineDash([2,4]);ctx.stroke();ctx.setLineDash([]);
  ctx.font="500 8px 'Outfit',sans-serif";ctx.fillStyle='#ffffff25';ctx.textAlign='left';ctx.fillText('Earth-size',pad.l+4,ey-4);
  // Grid
  for(let i=0;i<=4;i++){const v=yMax*i/4;const y=y2px(v);ctx.beginPath();ctx.moveTo(pad.l,y);ctx.lineTo(pad.l+pw,y);ctx.strokeStyle='#ffffff06';ctx.lineWidth=1;ctx.stroke();ctx.font="500 8px 'JetBrains Mono',monospace";ctx.fillStyle='#8887a0';ctx.textAlign='right';ctx.fillText(v.toFixed(1),pad.l-6,y+3)}
  // Axes
  ctx.strokeStyle='#ffffff18';ctx.lineWidth=1;ctx.beginPath();ctx.moveTo(pad.l,pad.t);ctx.lineTo(pad.l,pad.t+ph);ctx.lineTo(pad.l+pw,pad.t+ph);ctx.stroke();
  ctx.font="500 9px 'Outfit',sans-serif";ctx.fillStyle='#8887a060';ctx.textAlign='center';ctx.fillText('Distance / HZ Center',pad.l+pw/2,pad.t+ph+32);
  ctx.save();ctx.translate(12,pad.t+ph/2);ctx.rotate(-Math.PI/2);ctx.fillText('Planet Radius (R‚äï)',0,0);ctx.restore();
  // X ticks
  [0,0.5,1.0,1.5,2.0,2.5,3.0].forEach(v=>{if(v>xMax)return;const x=x2px(v);ctx.font="500 8px 'JetBrains Mono',monospace";ctx.fillStyle='#8887a0';ctx.textAlign='center';ctx.fillText(v.toFixed(1),x,pad.t+ph+14)});
  // Planets
  allP.forEach(p=>{
    const px=x2px(p.normDist),py=y2px(p.radius);const r=4;
    if(p.inHz){for(let g=2;g>=0;g--){const gr=ctx.createRadialGradient(px,py,0,px,py,r+g*4);gr.addColorStop(0,'#34d39930');gr.addColorStop(1,'transparent');ctx.fillStyle=gr;ctx.beginPath();ctx.arc(px,py,r+g*4,0,Math.PI*2);ctx.fill()}}
    ctx.fillStyle=p.inHz?'#34d399':'#8887a060';ctx.beginPath();ctx.arc(px,py,r,0,Math.PI*2);ctx.fill();
    if(p.inHz){ctx.strokeStyle='#34d39960';ctx.lineWidth=1;ctx.stroke()}
  });
}

// ===== SUMMARY STAT =====
function drawSummary(){
  let total=0,hzCount=0;
  Object.values(SYSTEMS).forEach(s=>{const l=getLum(s.star_temp_K,s.star_radius_solar);const hz=getHZ(l);s.planets.forEach(p=>{total++;if(p.orbital_distance_AU>=hz.inner&&p.orbital_distance_AU<=hz.outer)hzCount++})});
  const pct=total>0?Math.round(hzCount/total*100):0;
  document.getElementById('summaryPct').textContent=pct+'%';
  document.getElementById('summaryText').textContent=`${hzCount} of ${total} known planets across all ${Object.keys(SYSTEMS).length} systems fall within their star's habitable zone`;
}

// ===== HR DIAGRAM =====
const HR_MS=[[42000,500000],[30000,30000],[20000,4000],[15000,1000],[10000,50],[8000,10],[7000,5],[6000,1.5],[5500,0.8],[5000,0.4],[4500,0.15],[4000,0.05],[3500,0.015],[3000,0.004],[2500,0.001]];
const HR_MS_U=[[42000,1500000],[30000,100000],[20000,15000],[15000,4000],[10000,200],[8000,40],[7000,15],[6000,4],[5500,2],[5000,1],[4500,0.4],[4000,0.12],[3500,0.04],[3000,0.01],[2500,0.003]];
const HR_MS_L=[[42000,150000],[30000,10000],[20000,1200],[15000,300],[10000,15],[8000,4],[7000,1.8],[6000,0.6],[5500,0.35],[5000,0.18],[4500,0.06],[4000,0.02],[3500,0.006],[3000,0.0015],[2500,0.0004]];

function drawHRDiagram(selectedKey){
  const canvas=document.getElementById('hrCanvas');if(!canvas)return;
  const cw=canvas.parentElement;const dpr=window.devicePixelRatio||1;const W=cw.offsetWidth,H=cw.offsetHeight;
  canvas.width=W*dpr;canvas.height=H*dpr;canvas.style.width=W+'px';canvas.style.height=H+'px';
  const ctx=canvas.getContext('2d');ctx.setTransform(dpr,0,0,dpr,0,0);
  const pad={t:30,r:30,b:50,l:65};const pw=W-pad.l-pad.r,ph=H-pad.t-pad.b;
  const tMin=Math.log10(2200),tMax=Math.log10(45000),lMin=-4,lMax=6;
  const t2x=t=>pad.l+pw*(1-(Math.log10(t)-tMin)/(tMax-tMin));
  const l2y=l=>pad.t+ph*(1-(Math.log10(l)-lMin)/(lMax-lMin));
  ctx.clearRect(0,0,W,H);
  [2500,3000,4000,5000,6000,8000,10000,15000,20000,30000,40000].forEach(t=>{const x=t2x(t);if(x<pad.l||x>pad.l+pw)return;ctx.beginPath();ctx.moveTo(x,pad.t);ctx.lineTo(x,pad.t+ph);ctx.strokeStyle='#ffffff08';ctx.lineWidth=1;ctx.stroke()});
  [-3,-2,-1,0,1,2,3,4,5].forEach(e=>{const y=l2y(Math.pow(10,e));if(y<pad.t||y>pad.t+ph)return;ctx.beginPath();ctx.moveTo(pad.l,y);ctx.lineTo(pad.l+pw,y);ctx.strokeStyle='#ffffff08';ctx.lineWidth=1;ctx.stroke()});
  ctx.save();ctx.beginPath();HR_MS_U.forEach((p,i)=>{const x=t2x(p[0]),y=l2y(p[1]);i===0?ctx.moveTo(x,y):ctx.lineTo(x,y)});HR_MS_L.slice().reverse().forEach(p=>{ctx.lineTo(t2x(p[0]),l2y(p[1]))});ctx.closePath();
  const msG=ctx.createLinearGradient(t2x(40000),0,t2x(2500),0);msG.addColorStop(0,'#9bb0ff12');msG.addColorStop(0.5,'#fff4ea10');msG.addColorStop(1,'#ffac6b12');ctx.fillStyle=msG;ctx.fill();
  ctx.beginPath();HR_MS.forEach((p,i)=>{const x=t2x(p[0]),y=l2y(p[1]);i===0?ctx.moveTo(x,y):ctx.lineTo(x,y)});ctx.strokeStyle='#ffffff15';ctx.lineWidth=1.5;ctx.setLineDash([4,4]);ctx.stroke();ctx.setLineDash([]);ctx.restore();
  ctx.save();const mlx=t2x(7000),mly=l2y(3);ctx.translate(mlx,mly);ctx.rotate(-0.52);ctx.font="500 10px 'Outfit',sans-serif";ctx.fillStyle='#ffffff1a';ctx.textAlign='center';ctx.fillText('MAIN SEQUENCE',0,0);ctx.restore();
  [{l:'O',a:30000,b:45000,c:'#9bb0ff'},{l:'B',a:10000,b:30000,c:'#aabfff'},{l:'A',a:7500,b:10000,c:'#cad7ff'},{l:'F',a:6000,b:7500,c:'#f8f7ff'},{l:'G',a:5200,b:6000,c:'#fff4ea'},{l:'K',a:3700,b:5200,c:'#ffd2a1'},{l:'M',a:2200,b:3700,c:'#ffac6b'}].forEach(s=>{const x1=t2x(s.b),x2=t2x(s.a);ctx.fillStyle=s.c+'15';ctx.fillRect(x1,pad.t,x2-x1,12);ctx.font="600 8px 'JetBrains Mono',monospace";ctx.fillStyle=s.c+'80';ctx.textAlign='center';ctx.fillText(s.l,(x1+x2)/2,pad.t+9)});
  ctx.save();ctx.strokeStyle='#ffffff18';ctx.lineWidth=1;ctx.beginPath();ctx.moveTo(pad.l,pad.t);ctx.lineTo(pad.l,pad.t+ph);ctx.lineTo(pad.l+pw,pad.t+ph);ctx.stroke();
  ctx.font="500 9px 'JetBrains Mono',monospace";ctx.fillStyle='#8887a0';ctx.textAlign='center';
  [3000,5000,7000,10000,15000,25000,40000].forEach(t=>{const x=t2x(t);if(x<pad.l+10||x>pad.l+pw-10)return;ctx.fillText(t>=10000?(t/1000)+'k':t,x,pad.t+ph+16)});
  ctx.font="500 10px 'Outfit',sans-serif";ctx.fillStyle='#8887a060';ctx.fillText('‚Üê hot          Temperature (K)          cool ‚Üí',pad.l+pw/2,pad.t+ph+38);
  ctx.textAlign='right';ctx.font="500 9px 'JetBrains Mono',monospace";ctx.fillStyle='#8887a0';
  [-3,-2,-1,0,1,2,3,4,5].forEach(e=>{const y=l2y(Math.pow(10,e));if(y<pad.t+5||y>pad.t+ph-5)return;ctx.fillText(e===0?'1':e===1?'10':'10^'+e,pad.l-10,y+3)});
  ctx.save();ctx.translate(16,pad.t+ph/2);ctx.rotate(-Math.PI/2);ctx.font="500 10px 'Outfit',sans-serif";ctx.fillStyle='#8887a0';ctx.textAlign='center';ctx.fillText('Luminosity (L‚òâ)',0,0);ctx.restore();ctx.restore();
  const sd=[];Object.keys(SYSTEMS).forEach(k=>{const s=SYSTEMS[k];const l=getLum(s.star_temp_K,s.star_radius_solar);const spec=classifyStar(s.star_temp_K);sd.push({key:k,name:s.star_name,temp:s.star_temp_K,lum:l,radius:s.star_radius_solar,spec,x:t2x(s.star_temp_K),y:l2y(l)})});
  sd.forEach(s=>{if(s.key===selectedKey)return;const dr=Math.max(5,Math.min(18,s.radius*6));const g=ctx.createRadialGradient(s.x,s.y,0,s.x,s.y,dr+8);g.addColorStop(0,s.spec.color+'30');g.addColorStop(1,'transparent');ctx.fillStyle=g;ctx.beginPath();ctx.arc(s.x,s.y,dr+8,0,Math.PI*2);ctx.fill();const dg=ctx.createRadialGradient(s.x,s.y,0,s.x,s.y,dr);dg.addColorStop(0,'#fff');dg.addColorStop(0.35,s.spec.color);dg.addColorStop(1,s.spec.color+'60');ctx.fillStyle=dg;ctx.beginPath();ctx.arc(s.x,s.y,dr,0,Math.PI*2);ctx.fill();ctx.font="500 9px 'Outfit',sans-serif";ctx.fillStyle=s.spec.color+'bb';ctx.textAlign='center';ctx.fillText(s.name,s.x,s.y-dr-6)});
  const sel=sd.find(s=>s.key===selectedKey);
  if(sel){const dr=Math.max(6,Math.min(20,sel.radius*6));for(let i=3;i>=0;i--){const g=ctx.createRadialGradient(sel.x,sel.y,0,sel.x,sel.y,dr+12+i*10);g.addColorStop(0,'#f472b6'+(i===0?'40':'10'));g.addColorStop(1,'transparent');ctx.fillStyle=g;ctx.beginPath();ctx.arc(sel.x,sel.y,dr+12+i*10,0,Math.PI*2);ctx.fill()}ctx.beginPath();ctx.arc(sel.x,sel.y,dr+5,0,Math.PI*2);ctx.strokeStyle='#f472b690';ctx.lineWidth=2;ctx.stroke();const dg=ctx.createRadialGradient(sel.x,sel.y,0,sel.x,sel.y,dr);dg.addColorStop(0,'#fff');dg.addColorStop(0.3,sel.spec.color);dg.addColorStop(1,sel.spec.color+'80');ctx.fillStyle=dg;ctx.beginPath();ctx.arc(sel.x,sel.y,dr,0,Math.PI*2);ctx.fill();ctx.font="600 11px 'Outfit',sans-serif";ctx.fillStyle='#fff';ctx.textAlign='center';ctx.fillText(sel.name,sel.x,sel.y-dr-10)}
  canvas._hrStars=sd;
}
document.getElementById('hrCanvas').addEventListener('click',function(e){const r=this.getBoundingClientRect();const mx=e.clientX-r.left,my=e.clientY-r.top;const st=this._hrStars;if(!st)return;for(let i=st.length-1;i>=0;i--){const s=st[i],dr=Math.max(5,Math.min(18,s.radius*6))+8;if((mx-s.x)**2+(my-s.y)**2<=dr*dr){document.getElementById('systemSelect').value=s.key;onSystemSelect();return}}});
document.getElementById('hrCanvas').addEventListener('mousemove',function(e){const r=this.getBoundingClientRect();const mx=e.clientX-r.left,my=e.clientY-r.top;const st=this._hrStars;if(!st){this.style.cursor='default';return}let f=false;for(let i=st.length-1;i>=0;i--){const s=st[i],dr=Math.max(5,Math.min(18,s.radius*6))+8;if((mx-s.x)**2+(my-s.y)**2<=dr*dr){f=true;break}}this.style.cursor=f?'pointer':'default'});

// ===== COMPARE MODE =====
function setMode(m){compareMode=m==='compare';document.getElementById('modeExplore').classList.toggle('active',!compareMode);document.getElementById('modeCompare').classList.toggle('active',compareMode);document.getElementById('exploreWrap').style.display=compareMode?'none':'block';document.getElementById('compareWrap').classList.toggle('visible',compareMode);if(compareMode)buildCompareColumns();else{cmpAnimFrames.forEach((f,i)=>{if(f)cancelAnimationFrame(f);cmpAnimFrames[i]=null});cmpStates=[null,null]}}
function buildCompareColumns(){[0,1].forEach(i=>{const col=document.getElementById('cmpCol'+i);const opts=Object.keys(SYSTEMS).map(k=>`<option value="${k}"${k===cmpDefaults[i]?' selected':''}>${SYSTEMS[k].star_name}</option>`).join('');col.innerHTML=`<select class="cmp-select" onchange="updateCompare(${i},this.value)">${opts}</select><div class="cmp-star-info" id="cmpStarInfo${i}"></div><div class="cmp-stats" id="cmpStats${i}"></div><div class="cmp-canvas-wrap" id="cmpCanvasWrap${i}"><canvas id="cmpCanvas${i}"></canvas></div><div class="cmp-planet-list" id="cmpPlanets${i}"></div>`;updateCompare(i,cmpDefaults[i])})}
function updateCompare(idx,sysKey){cmpDefaults[idx]=sysKey;const sys=SYSTEMS[sysKey];if(!sys)return;const t=sys.star_temp_K,r=sys.star_radius_solar;const l=getLum(t,r);const hz=getHZ(l);const spec=classifyStar(t);const planets=sys.planets;const hzN=planets.filter(p=>p.orbital_distance_AU>=hz.inner&&p.orbital_distance_AU<=hz.outer).length;const fmtL=l>=1000?l.toExponential(2):l>=1?l.toFixed(2):l>=0.001?l.toFixed(4):l.toExponential(2);const fA=v=>v>=10?v.toFixed(1):v>=0.1?v.toFixed(3):v.toFixed(4);
  document.getElementById('cmpStarInfo'+idx).innerHTML=`<div class="cmp-star-dot" style="background:radial-gradient(circle,#fff,${spec.color});box-shadow:0 0 14px ${spec.color}80"></div><div class="cmp-star-details"><div class="cmp-star-name">${sys.star_name}</div><div class="cmp-star-meta">Class ${spec.cls} ¬∑ ${spec.name} ¬∑ ${t.toLocaleString()} K</div></div>`;
  document.getElementById('cmpStats'+idx).innerHTML=`<div class="cmp-stat"><div class="cmp-stat-label">Luminosity</div><div class="cmp-stat-value" style="color:${spec.color}">${fmtL} L‚òâ</div></div><div class="cmp-stat"><div class="cmp-stat-label">Radius</div><div class="cmp-stat-value">${r} R‚òâ</div></div><div class="cmp-stat"><div class="cmp-stat-label">HZ Inner</div><div class="cmp-stat-value" style="color:#f47240">${fA(hz.inner)} AU</div></div><div class="cmp-stat"><div class="cmp-stat-label">HZ Outer</div><div class="cmp-stat-value" style="color:#67a8f9">${fA(hz.outer)} AU</div></div>`;
  let pl='';planets.forEach(p=>{const inHz=p.orbital_distance_AU>=hz.inner&&p.orbital_distance_AU<=hz.outer;pl+=`<div class="cmp-planet"><span class="cmp-planet-dot" style="background:${inHz?'var(--green)':'var(--pink)'};box-shadow:0 0 4px ${inHz?'var(--green)':'var(--pink)'}"></span><span class="cmp-planet-name">${p.name}</span><span class="cmp-planet-dist">${p.orbital_distance_AU} AU</span><span class="cmp-planet-hz" style="color:${inHz?'var(--green)':'var(--text-faint)'}">${inHz?'HZ ‚úì':''}</span></div>`});
  document.getElementById('cmpPlanets'+idx).innerHTML=pl;initCmpCanvas(idx,spec,hz.inner,hz.outer,planets)}
function initCmpCanvas(idx,spec,hzI,hzO,planets){if(cmpAnimFrames[idx])cancelAnimationFrame(cmpAnimFrames[idx]);const canvas=document.getElementById('cmpCanvas'+idx);const cw=canvas.parentElement;const dpr=window.devicePixelRatio||1;const W=cw.offsetWidth,H=cw.offsetHeight;canvas.width=W*dpr;canvas.height=H*dpr;canvas.style.width=W+'px';canvas.style.height=H+'px';const ctx=canvas.getContext('2d');ctx.setTransform(dpr,0,0,dpr,0,0);const cx=W/2,cy=H/2;const maxDist=Math.max(hzO*1.3,...planets.map(p=>p.orbital_distance_AU));const scale=(Math.min(W,H)/2-36)/maxDist;const pData=planets.map(p=>({...p,inHz:p.orbital_distance_AU>=hzI&&p.orbital_distance_AU<=hzO,angle:Math.random()*Math.PI*2,speed:0.3/Math.sqrt(p.orbital_distance_AU/planets[0].orbital_distance_AU),trail:[],trailMax:p.orbital_distance_AU>=hzI&&p.orbital_distance_AU<=hzO?45:20}));
  canvas.onmousemove=function(e){const r=canvas.getBoundingClientRect();cmpMouse[idx].x=e.clientX-r.left;cmpMouse[idx].y=e.clientY-r.top};canvas.onmouseleave=function(){cmpMouse[idx]={x:-1,y:-1,hovered:null};canvas.style.cursor='default'};
  let tip=document.getElementById('cmpTip'+idx);if(!tip){tip=document.createElement('div');tip.id='cmpTip'+idx;tip.style.cssText='position:absolute;pointer-events:none;opacity:0;transition:opacity .15s;z-index:20;background:#12121cee;border:1px solid #2a2a44;border-radius:10px;padding:12px 16px;font-family:Outfit,sans-serif;font-size:.78rem;color:#e0dff0;box-shadow:0 8px 30px #000000a0;min-width:160px';cw.appendChild(tip)}
  cmpStates[idx]={spec,hzInner:hzI,hzOuter:hzO,planets:pData,cx,cy,scale,W,H,ctx,canvas,dpr,startTime:performance.now()};renderCmpCanvas(idx)}
function renderCmpCanvas(idx){const s=cmpStates[idx];if(!s||!compareMode){cmpAnimFrames[idx]=null;return}const{ctx,W,H,cx,cy,scale,spec,hzInner,hzOuter,planets}=s;const t=(performance.now()-s.startTime)/1000;ctx.clearRect(0,0,W,H);
  const bgG=ctx.createRadialGradient(cx,cy,0,cx,cy,Math.min(W,H)/2);bgG.addColorStop(0,spec.color+'08');bgG.addColorStop(1,'transparent');ctx.fillStyle=bgG;ctx.fillRect(0,0,W,H);
  const hzInPx=Math.max(0,hzInner*scale),hzOutPx=Math.max(0,hzOuter*scale);ctx.save();ctx.beginPath();ctx.arc(cx,cy,hzOutPx,0,Math.PI*2);if(hzInPx>0)ctx.arc(cx,cy,hzInPx,0,Math.PI*2,true);ctx.closePath();const hzG=ctx.createRadialGradient(cx,cy,hzInPx,cx,cy,hzOutPx);hzG.addColorStop(0,'#34d39918');hzG.addColorStop(1,'#34d39908');ctx.fillStyle=hzG;ctx.fill();ctx.beginPath();ctx.arc(cx,cy,Math.max(0,hzInPx),0,Math.PI*2);ctx.strokeStyle='#34d39920';ctx.lineWidth=1;ctx.setLineDash([3,5]);ctx.stroke();ctx.beginPath();ctx.arc(cx,cy,Math.max(0,hzOutPx),0,Math.PI*2);ctx.stroke();ctx.setLineDash([]);ctx.restore();
  planets.forEach(p=>{const r=Math.max(0,p.orbital_distance_AU*scale);ctx.beginPath();ctx.arc(cx,cy,r,0,Math.PI*2);ctx.strokeStyle=p.inHz?'#34d39918':'#ffffff0a';ctx.lineWidth=1;ctx.stroke()});
  planets.forEach(p=>{if(animating)p.angle+=p.speed*0.016;const r=Math.max(0,p.orbital_distance_AU*scale);const px=cx+Math.cos(p.angle)*r,py=cy+Math.sin(p.angle)*r;p.trail.push({x:px,y:py,age:0});if(p.trail.length>p.trailMax)p.trail.shift();p.trail.forEach(pt=>pt.age++)});
  planets.forEach(p=>{if(p.trail.length<2)return;for(let i=1;i<p.trail.length;i++){const a=1-(p.trail[i].age/p.trailMax);if(a<=0)continue;const al=a*a*(p.inHz?0.5:0.15);ctx.beginPath();ctx.moveTo(p.trail[i-1].x,p.trail[i-1].y);ctx.lineTo(p.trail[i].x,p.trail[i].y);ctx.strokeStyle=p.inHz?`rgba(52,211,153,${al})`:`rgba(244,114,182,${al})`;ctx.lineWidth=p.inHz?2.5:1.2;ctx.lineCap='round';ctx.stroke()}});
  const starR=Math.max(6,Math.min(16,spec.cls==='M'||spec.cls==='K'?6:10));const sp=0.7+0.3*Math.sin(t*1.5);for(let i=3;i>=0;i--){const gs=Math.max(0.1,starR+i*12*(.8+.2*Math.sin(t*2.3)));const gr=ctx.createRadialGradient(cx,cy,0,cx,cy,gs);gr.addColorStop(0,spec.color+(i===0?'ff':'00'));gr.addColorStop(0.3,spec.color+(i<2?Math.round(40*sp).toString(16).padStart(2,'0'):'08'));gr.addColorStop(1,'transparent');ctx.fillStyle=gr;ctx.beginPath();ctx.arc(cx,cy,gs,0,Math.PI*2);ctx.fill()}
  const cR=Math.max(0.1,starR*(.95+.05*Math.sin(t*1.5)));const sg=ctx.createRadialGradient(cx,cy,0,cx,cy,cR);sg.addColorStop(0,'#fff');sg.addColorStop(0.3,spec.color);sg.addColorStop(1,spec.color+'80');ctx.fillStyle=sg;ctx.beginPath();ctx.arc(cx,cy,cR,0,Math.PI*2);ctx.fill();
  const m=cmpMouse[idx];let newH=null;
  planets.forEach((p,i)=>{const r=Math.max(0,p.orbital_distance_AU*scale);const px=cx+Math.cos(p.angle)*r,py=cy+Math.sin(p.angle)*r;const isH=m.hovered&&m.hovered.name===p.name;const dR=(p.inHz?4:3)*(isH?1.7:1);if(p.inHz){const pu=0.5+0.5*Math.sin(t*2+i);for(let g=2;g>=0;g--){const gR=Math.max(0.1,dR+g*5);const gg=ctx.createRadialGradient(px,py,0,px,py,gR);gg.addColorStop(0,`rgba(52,211,153,${0.12*pu})`);gg.addColorStop(1,'transparent');ctx.fillStyle=gg;ctx.beginPath();ctx.arc(px,py,gR,0,Math.PI*2);ctx.fill()}}
    const pg=ctx.createRadialGradient(px,py,0,px,py,Math.max(0.1,dR));if(p.inHz){pg.addColorStop(0,'#fff');pg.addColorStop(0.4,'#34d399');pg.addColorStop(1,'#34d39980')}else{pg.addColorStop(0,'#fff');pg.addColorStop(0.4,'#f472b6');pg.addColorStop(1,'#f472b680')}ctx.fillStyle=pg;ctx.beginPath();ctx.arc(px,py,Math.max(0.1,dR),0,Math.PI*2);ctx.fill();
    if(m.x>=0){const dx=m.x-px,dy=m.y-py;if(dx*dx+dy*dy<=16*16)newH=p}
    if(showLabels){ctx.save();ctx.font="500 9px 'Outfit',sans-serif";ctx.textAlign='center';ctx.fillStyle=p.inHz?'#34d399aa':'#f472b688';ctx.fillText(p.name.split(' ').pop(),px+Math.cos(p.angle)*(dR+10),py+Math.sin(p.angle)*(dR+10)+3);ctx.restore()}
  });
  cmpMouse[idx].hovered=newH;const tip=document.getElementById('cmpTip'+idx);const canvas=s.canvas;
  if(tip){if(newH){const p=newH;tip.innerHTML=`<div style="font-weight:600;font-size:.88rem;margin-bottom:6px;color:${p.inHz?'#34d399':'#f472b6'}">${p.name}</div><div style="display:grid;grid-template-columns:auto 1fr;gap:3px 10px;font-size:.74rem;line-height:1.6"><span style="color:#8887a0">Dist</span><span style="font-family:'JetBrains Mono',monospace">${p.orbital_distance_AU} AU</span><span style="color:#8887a0">Radius</span><span style="font-family:'JetBrains Mono',monospace">${p.radius_earth!=null?p.radius_earth.toFixed(3)+' R‚äï':'?'}</span></div><div style="margin-top:6px;padding-top:6px;border-top:1px solid #1e1e34;font-size:.74rem">${p.inHz?'<span style="color:#34d399">‚óè HZ</span>':'<span style="color:#f87171">‚óã Outside</span>'}</div>`;const r=Math.max(0,p.orbital_distance_AU*scale);const ppx=cx+Math.cos(p.angle)*r,ppy=cy+Math.sin(p.angle)*r;let tx=ppx+14,ty=ppy-tip.offsetHeight-6;if(tx+tip.offsetWidth>W-8)tx=ppx-tip.offsetWidth-14;if(ty<8)ty=ppy+16;tip.style.left=tx+'px';tip.style.top=ty+'px';tip.style.opacity='1';canvas.style.cursor='pointer'}else{tip.style.opacity='0';canvas.style.cursor='default'}}
  cmpAnimFrames[idx]=requestAnimationFrame(()=>renderCmpCanvas(idx))}

function resetForm(){document.getElementById('systemSelect').value='solar';onSystemSelect()}
window.addEventListener('load',()=>{
  // Ensure Solar System is selected and calculated on load
  document.getElementById('systemSelect').value='solar';
  const s=SYSTEMS.solar;
  document.getElementById('starName').value=s.star_name;
  document.getElementById('starTemp').value=s.star_temp_K;
  document.getElementById('starRadius').value=s.star_radius_solar;
  currentPlanets=s.planets;
  syncSliderToInput();
  setTimeout(calculate,100);
});
let rt;window.addEventListener('resize',()=>{clearTimeout(rt);rt=setTimeout(()=>{if(document.getElementById('results').classList.contains('visible')&&!compareMode)calculate();if(compareMode)[0,1].forEach(i=>updateCompare(i,cmpDefaults[i]))},200)});
document.addEventListener('keydown',e=>{if(e.key==='Enter')calculate()});
</script>
</body>
</html>
